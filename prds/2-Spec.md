# Theia-Based FDC3 Workspace Platform

## Spec

**Product Vision:** The proposed platform is a **browser-based and Electron-based workspace container** that allows users to run multiple business applications (as pluggable “apps” - implemented as Theia extensions and packaged as VSIX files) side by side, share context between them, and organize their workflow by **workspaces**. It draws inspiration from OpenFin/HERE Enterprise Browser, but is built on open-source technology (Theia IDE). The goal is to provide the interoperability and unified experience of a financial desktop container while leveraging the rich ecosystem of VS Code extensions for app development.

### Key Use Cases and Features

- **Multiple Contextual Workspaces:** Users can create and manage multiple workspaces, each tied to a distinct context (for example, a specific client or project). Within a workspace, any context-changing action (like selecting a client) will broadcast to all apps in that workspace only, keeping other workspaces independent. Workspaces are presented as top-level tabs within the application (not separate browser tabs or windows), allowing quick switching. This enables a user to handle different clients or tasks in parallel without context collisions. _Why:_ In financial or enterprise workflows, users often juggle multiple clients/cases – separating them prevents confusion and fosters focus.
- **Flexible App Layouts:** Within each workspace, the user can arrange app windows (panels) flexibly in the central area. They can tile apps side-by-side, stack them in tabs, or split the view using Theia’s docking layout controls. There will be dedicated regions: an app launcher on the far left, a left sidebar for context/navigation apps (e.g. a client selector panel, a list of workspaces), a main content area for core apps, a right sidebar for the AI assistant and notifications center, and a bottom bar for logs and similar output. The layout should be persistent per workspace (with ability to save and restore layouts automatically when reopening a context). _Why:_ Users need to see multiple information sources simultaneously (e.g., client info app next to analytics app). Providing a flexible layout boosts productivity and mirrors familiar IDE or container layouts. We leverage Theia’s existing split-panel capabilities to implement this.
- **Context Sharing and FDC3 Interop:** The platform will include a global **DesktopAgent** to manage inter-app communication via the FDC3 standard. Apps can broadcast data (contexts) or raise intents (requests for action) that other apps in the same workspace can listen for and handle. For example, if an app broadcasting a `ClientContext` is active and the user selects a client “ACME Corp”, other apps in that workspace listening for `ClientContext` updates will receive that data and update themselves accordingly. If an app raises an intent like `ViewChart` for a particular stock, another app in the workspace can handle it (if it registered an intent listener for `ViewChart`). We will utilize Theia’s internal messaging mechanisms to route these events under the hood, but from the app developer’s perspective, they simply use the FDC3 API (`fdc3.broadcast`, `fdc3.raiseIntent`, etc.). The DesktopAgent ensures scope: context broadcasts or intents are delivered only to apps within the active workspace context (preventing bleed-over to other workspace tabs). _Why:_ This capability is analogous to OpenFin’s Interop and is core to a unified platform – it eliminates copy-paste and manual synchronization by linking apps together through shared context: [here.io](https://www.here.io/here-core#:~:text=Interop%20and%20FDC3%20APIs). Adopting the FDC3 standard means our container can integrate with any other FDC3-compliant apps or services in the future, reducing vendor lock-in for our users.
- **App Launching and Discovery (App Store):** Users can discover, install, and launch new apps through an integrated App Store interface. This will be based on the Open VSX extension registry. The platform will connect to a **self-hosted Open VSX registry** (an open-source marketplace for VS Code extensions) to fetch a list of available apps (VSIX packages): [theia-ide.org](https://theia-ide.org/docs/blueprint_documentation/#:~:text=Extension%20sources). Within the UI, a familiar Extensions view (rebranded as “App Store”) will allow searching or browsing apps by category. Installation of an app will make it immediately available in the platform. Launching apps: after installation, an app can be launched into the current workspace (for example, by clicking “Open” or via a dock menu if provided). We will repurpose the existing Theia/VS Code "Activity bar" as a Dock or App Launcher toolbar – a shortcut bar where frequently used apps or user-chosen apps can be pinned for one-click launching, similar to a taskbar. _Why:_ A built-in app store lowers the barrier to extending the platform and allows non-technical users to add capabilities easily. Using the VSIX format means developers can package apps in a known format and even reuse many VS Code extensions. A quick launcher (dock) improves UX by not requiring users to navigate menus to open apps they use often.
- **Notifications Center:** Applications within the workspace can raise notifications through the platform. We will use Theia’s notification UI (which typically shows a toast or message prompt) to display these. Notifications can include rich content and interactive elements (e.g., buttons). For example, a trading alert app might raise a notification “Price threshold reached for STOCK ABC” with options to “View Details” or “Snooze”. The platform will route notification click events back to the originating app or a designated handler via the FDC3 intent mechanism or direct callback. We will implement a **notification history view** (similar to the VS Code notification center or OpenFin’s Notification Center: [here.io](https://www.here.io/here-core#:~:text=Notification%20Center)) where users can see past notifications, group or filter them. This will need to have a toggle for all notifications, and just ones relevent to the current workspace.. _Why:_ Notifications are crucial in a multi-app environment to alert users of important events without requiring every app to be visible at all times. By centralizing them, we ensure users don’t miss critical updates. Using Theia’s existing mechanisms lets us implement this feature quickly and consistently.
- **Integrated AI Assistant Panel:** On the right sidebar of each workspace, users will have access to an AI chat assistant. We plan to leverage Theia’s built-in AI capabilities (Theia recently introduced an AI assistant integration: [theia-ide.org](https://theia-ide.org/docs/user_install_vscode_extensions/#:~:text=,12)) and adapt them to our context. This “AI Chat” panel can answer user queries, help with tasks like finding information across apps (akin to a super search), or even serve as a chatbot that interacts with the user’s current context. For instance, if the current workspace context is a client, the AI could be prompted with that context to answer questions specific to that client’s data (if such data is accessible). Initially, this AI assistant might rely on generic capabilities (like CodeGPT or an OpenAI integration included in Theia), but we will integrate it such that it’s easily accessible (opened by default in the right pane) and context-aware in the future. _Why:_ Many modern platforms include AI features to boost productivity. In our use case, an AI assistant can help summarize information from multiple apps or perform actions via intents upon user request, acting as a smart helper. Including it from the start (even if basic) sets the stage for advanced capabilities later (like natural language commands to navigate the workspace).
- **Logging and Debugging Tools:** To aid developers (and advanced users) in understanding the inter-app communication, the platform will include a logging view for FDC3 events and other app communications. We will repurpose or extend the existing Theia Output or Console panel to create an “Interop Log”. This log will record context broadcasts, intent raises, and resolution results in real-time, scoped by workspace. For example, if an app broadcasts a client context, an entry like “\[Workspace Alpha\] Broadcast ClientContext { clientId: 123 } by App X” would appear. Similarly, intents and their target resolution (which app handled it) would be logged. We may allow filtering this log by app or message type. _Why:_ In a complex app ecosystem, debugging who sent what context or why an intent didn’t trigger can be difficult. A built-in log viewer helps developers building apps on the platform to troubleshoot integration issues. It can also help with auditing and support, giving insight into the dynamic behavior of the workspace.

### Assumptions and Constraints

- **Initial Scope vs Future Enhancements:** Some features will **not** be part of the initial release but are noted for future consideration. For example, advanced **App Directory** functionality (a centralized directory of all available apps with their metadata and intent support) is something FDC3 supports: [fdc3.finos.org](https://fdc3.finos.org/docs/api/ref/DesktopAgent#:~:text=A%20Desktop%20Agent%20can%20be,and%20implementation%20requirements%20are%20proprietary), but initially we may rely on the Open VSX registry and simple metadata. Another future item is **FDC3 Desktop Agent bridging** (connecting our DesktopAgent with other containers on the same desktop) – not in scope now. Also, true multi-window support (e.g., dragging an app out into a separate native window or multi-monitor support) is deferred; initially all apps live inside the single container window with tabs. We want to validate the core concept in one window first. These decisions keep the project focused, but we are mindful that enterprise users might request them later.
- **No Traditional IDE Functions:** Since our platform repurposes Theia from a coding IDE to a business app container, we assume features like text editing, a file explorer, or debugger are **out of scope**. We will strip out or disable these by default. We will keep the integrated terminal, AI Chat View, and "Extensions" panel though. The user is not expected to edit source code or manage a file system in this product. Instead, the left sidebar will host domain-specific navigation (like client lists or menus provided by apps), not a tree of files. This assumption simplifies the UI and avoids user confusion. (One caveat: we might retain _some_ generic utilities like a browser-like Developer Tools access for troubleshooting webview apps, but only for developers mode.)
- **Platform Compatibility:** The product must run on both modern web browsers and as an installed desktop application (Electron-based) on Windows (and ideally Mac/Linux for completeness). We assume the environment will have at least Chrome/Chromium engine (Electron uses Chromium, and for browser we’ll target Chrome/Edge for best support). Theia’s web-first design means almost everything is web tech, which we embrace. We also assume moderate hardware capabilities on user machines (Theia and Electron are not extremely lightweight, but acceptable for enterprise desktops).
- **Security Considerations:** We assume apps are generally trusted within the enterprise (since they will be installed via our controlled app store). However, we will still sandbox web content delivered via URL using iframes. Fully trusted apps can be embedded directly as widgets without requiring sandboxing. The VS Code webview API already provides an isolated iframe for extensions’ web content with only allowed messaging back to extension code. We will enforce content security policies to prevent malicious behavior. Also, since the platform may handle sensitive financial data, we will ensure that context data broadcasting is kept in-memory and not logged or sent externally (unless an extension does so on its own). Any future multi-tenant or cloud features will need authentication and encryption, but for now we assume a single-user local environment without login (the user is already authenticated to their machine or network).
- **Performance Constraints:** Running multiple apps inside one container means performance needs attention. We expect users might have 5-10 apps open per workspace, and maybe a couple of workspaces active. Theia’s architecture runs all VS Code extensions in a separate process (the plugin host) and heavy-lifting on a backend process. We assume this will handle our use case, but we will monitor memory and CPU usage. If needed, we might put certain apps to sleep when not in use or unload entire workspaces from memory if a user hasn’t looked at one in a while (as a future optimization). For now, performance should be acceptable given typical VS Code can handle many extensions simultaneously.
- **Unknowns / Open Questions:** Throughout development, a few questions need clarification:

  - _FDC3 Version_: We assume FDC3 2.0+ (latest 2.2) for DesktopAgent API. This gives us the channels concept which we can use for workspace scoping. We should confirm if any backward compatibility with FDC3 1.2 is needed.
    **Answer:** We will only support FDC3 2.0+.
  - _Context Data Models_: What context types and intent names will our target apps use? We might define custom context types (e.g., `ClientContext` with clientId, name, etc.) for our domain. This requires coordination with app developers or an app directory schema later. **Answer:** We will be using custom context and intents at a later date, but initially, only standard FDC3 ones are required to be supported.
  - _App Directory Integration_: In the future, do we plan to integrate a formal FDC3 App Directory service for app discovery and metadata (beyond the Open VSX registry)? This could enhance features like `findIntent` by looking up which app can handle an intent. For now, we’ll implement a simple in-memory directory or use a manifest in each extension.
    **Answer:** For now, we’ll use a manifest in each extension.
  - _App Launcher UI_: We propose a dock for launching installed apps; we should confirm if this is desired in MVP or if using Theia’s Command Palette / menu is sufficient initially. A slick app launcher will improve UX but could be added later.
    **Answer:** We will repurpose the existing Theia/VS Code "Activity bar" as a Dock or App Launcher toolbar
  - _Layout Persistence_: Should we implement saving and restoring of workspace layouts (positions and open apps) across sessions? We assume yes for user convenience, but it adds complexity (especially since we aren’t using file-workspaces to auto-save state). Possibly we store layout in local storage or a settings file keyed by workspace context. This needs confirmation.
    **Answer:** Yes, just persist to local storage initially.
  - _Branding and Naming_: We refer to the product as “Theia FDC3 Platform” here, but a proper product name and branding (icons, logos) will be needed. This is a minor point but part of polish – presumably will be decided later in the project. **Answer:** Just refer to it as "Theia FDC3" for now.
